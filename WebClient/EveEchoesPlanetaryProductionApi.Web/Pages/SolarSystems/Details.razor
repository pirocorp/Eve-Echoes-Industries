@page "/details"
@page "/details/{SolarSystemId:long}"
@page "/system/{SolarSystemId:long}"

@using EveEchoesPlanetaryProductionApi.Services.Data.Models.SolarSystems.GetSolarSystemById
@using EveEchoesPlanetaryProductionApi.Web.Services
@using EveEchoesPlanetaryProductionApi.Web.Components.SolarSystems
@using EveEchoesPlanetaryProductionApi.Web.Components.Loaders

@inject IAppDataService AppDataService;
@inject IEveApiService eveApiService;

<div class="container">
    <div class="row">
        @if (this.SolarSystem is null)
        {
            <Loader></Loader>
        }
        else
        {
            <SolarSystemDetails SolarSystem="this.SolarSystem"></SolarSystemDetails>
        }
    </div>
</div>

@code {
    [Parameter]
    public long SolarSystemId { get; set; }

    public SolarSystemServiceModel SolarSystem { get; set; }

    protected override async Task OnInitializedAsync()
    {
        if (this.SolarSystemId <= 0)
        {
            this.SolarSystem = this.AppDataService.CurrentSolarSystem ?? await this.eveApiService.Systems.GetRandomAsync();
            this.AppDataService.CurrentSolarSystem ??= this.SolarSystem;
        }
        else
        {
            this.SolarSystem = await this.eveApiService.Systems.GetAsync(this.SolarSystemId);
            this.AppDataService.CurrentSolarSystem = this.SolarSystem;
        }

        await base.OnInitializedAsync();
    }
}
